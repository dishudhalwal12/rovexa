<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMPIRE OS // KRISHNA_PRIME</title>
    
    <!-- Typography: JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100..800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        deep: '#050505',
                        panel: 'rgba(255, 255, 255, 0.02)',
                        border: 'rgba(255, 255, 255, 0.06)',
                        matcha: '#B2F838', // Electric Matcha
                        matchaDim: 'rgba(178, 248, 56, 0.1)',
                        vapor: '#F2F4F8',
                        alert: '#FF3333',
                        mute: '#666666'
                    },
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'ticker': 'tickerMove 20s linear infinite',
                        'fade-in': 'fadeIn 1s ease-out forwards',
                        'scale-in': 'scaleIn 0.6s ease-out forwards',
                    },
                    keyframes: {
                        tickerMove: {
                            '0%': { transform: 'translateY(0)' },
                            '100%': { transform: 'translateY(-50%)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.98)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #F2F4F8;
            font-family: 'JetBrains Mono', monospace;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Scrollbar aesthetics */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #050505;
        }
        ::-webkit-scrollbar-thumb {
            background: #222;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #333;
        }

        /* Utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        
        .input-reset {
            background: transparent;
            border: none;
            outline: none;
            color: inherit;
        }

        .matcha-glow {
            text-shadow: 0 0 10px rgba(178, 248, 56, 0.3);
        }

        /* Secure Text Redaction */
        .secure-redact {
            background: rgba(255, 255, 255, 0.1);
            color: transparent;
            cursor: pointer;
            user-select: none;
            padding: 0 4px;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .secure-redact::after {
            content: "ENCRYPTED";
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: #666;
            letter-spacing: 1px;
        }
        .secure-redact.revealed {
            background: rgba(178, 248, 56, 0.05);
            color: #B2F838;
            border: 1px solid rgba(178, 248, 56, 0.2);
        }
        .secure-redact.revealed::after {
            display: none;
        }
    </style>
</head>
<body class="h-screen flex flex-col selection:bg-matcha selection:text-black">

    <!-- INITIALIZE OVERLAY -->
    <div id="init-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-deep transition-opacity duration-1000">
        <div class="text-center">
            <div class="mb-8 opacity-50 text-xs tracking-[0.3em] uppercase">Private System Access</div>
            <button id="init-btn" class="group relative px-8 py-4 glass-panel rounded-full overflow-hidden hover:border-matcha/50 transition-colors duration-500">
                <span class="relative z-10 text-sm tracking-widest group-hover:text-matcha transition-colors">INITIALIZE EMPIRE OS</span>
                <div class="absolute inset-0 bg-matcha/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            </button>
        </div>
    </div>

    <!-- MAIN INTERFACE (Hidden initially) -->
    <div id="app-interface" class="flex-1 flex flex-col opacity-0 transition-opacity duration-1000 pointer-events-none">
        
        <!-- TOP BAR -->
        <header class="h-14 border-b border-border flex items-center justify-between px-6 bg-deep/80 backdrop-blur-md fixed top-0 w-full z-40">
            <div class="flex items-center gap-4">
                <div class="w-2 h-2 rounded-full bg-matcha shadow-[0_0_8px_#B2F838]"></div>
                <span class="text-sm font-bold tracking-widest text-white">KRISHNA_PRIME</span>
                <span class="text-xs text-mute ml-2">v4.0.1 BUILD_JAIPUR</span>
            </div>

            <!-- Vertical Ticker -->
            <div class="hidden md:block h-8 overflow-hidden relative w-64 mask-image-gradient">
                <div class="animate-ticker flex flex-col gap-2 text-xs text-mute/80 text-right">
                    <span>GHUNGHAT_EVENTS <span class="text-matcha">▲ 12%</span></span>
                    <span>KRISHNA_REALTY <span class="text-matcha">▲ 08%</span></span>
                    <span>MOOLCHAND_FIN <span class="text-matcha">▲ 15%</span></span>
                    <span>KRISHNA_HLTH <span class="text-mute">● PRE</span></span>
                    <!-- Duplicate for loop -->
                    <span>GHUNGHAT_EVENTS <span class="text-matcha">▲ 12%</span></span>
                    <span>KRISHNA_REALTY <span class="text-matcha">▲ 08%</span></span>
                    <span>MOOLCHAND_FIN <span class="text-matcha">▲ 15%</span></span>
                </div>
            </div>

            <div class="flex items-center gap-6">
                <div class="flex items-center gap-2 cursor-pointer group" id="ambient-toggle">
                    <div id="ambient-indicator" class="w-1.5 h-1.5 rounded-full bg-mute transition-colors duration-300"></div>
                    <span class="text-[10px] uppercase tracking-wider text-mute group-hover:text-white transition-colors">Ambient</span>
                </div>
                <div class="text-[10px] text-mute font-mono" id="system-time">00:00:00 UTC</div>
            </div>
        </header>

        <!-- DASHBOARD GRID -->
        <main class="flex-1 flex pt-14 h-full overflow-hidden">
            
            <!-- CENTRAL TIMELINE (Story Stream) -->
            <div class="flex-1 overflow-y-auto px-4 md:px-12 py-8 scroll-smooth" id="scroll-container">
                <div class="max-w-3xl mx-auto pb-32">
                    
                    <!-- Header Area -->
                    <div class="mb-12 border-l border-matcha/30 pl-6 py-2 animate-fade-in">
                        <h1 class="text-3xl md:text-4xl font-light text-white mb-2">Ecosystem Log</h1>
                        <p class="text-mute text-sm max-w-lg">Tracking the vertical integration of the Rajasthan Empire. From Event Lifecycle to Real Estate Dominance.</p>
                    </div>

                    <!-- Composer -->
                    <div class="glass-panel rounded-xl p-1 mb-12 transition-all duration-300 focus-within:border-matcha/40 focus-within:shadow-[0_0_20px_rgba(178,248,56,0.05)]">
                        <textarea id="log-input" rows="3" class="w-full bg-transparent text-sm p-4 resize-none outline-none placeholder-mute/50" placeholder="Log new development... Supports [tag:NAME], [secure]secret[/secure], [img:URL]"></textarea>
                        <div class="flex justify-between items-center px-4 pb-2 border-t border-border pt-2">
                            <div class="text-[10px] text-mute flex gap-2">
                                <span>CMD+ENTER TO LOG</span>
                            </div>
                            <button id="submit-log" class="text-xs bg-white/5 hover:bg-matcha hover:text-black px-4 py-1.5 rounded transition-colors duration-300 font-medium">EXECUTE</button>
                        </div>
                    </div>

                    <!-- Feed -->
                    <div id="log-feed" class="flex flex-col gap-8 relative">
                        <!-- Dynamic Content loads here -->
                        <div class="absolute left-0 top-0 bottom-0 w-px bg-border -ml-px hidden md:block" style="left: -2rem;"></div>
                    </div>

                </div>
            </div>

            <!-- RIGHT COLUMN (Stats) -->
            <aside class="w-80 border-l border-border hidden lg:flex flex-col p-6 gap-6 bg-deep/50 z-10">
                
                <!-- Stat Card 1 -->
                <div class="glass-panel p-5 rounded-lg">
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-[10px] text-mute uppercase tracking-widest">Nodal City</span>
                        <span class="text-matcha text-xs">● ACTIVE</span>
                    </div>
                    <div class="text-2xl text-white font-light mb-1">JAIPUR</div>
                    <div class="text-xs text-mute">Strategic Hub & HQ</div>
                    <div class="w-full bg-white/10 h-0.5 mt-4">
                        <div class="bg-matcha h-full w-[85%] shadow-[0_0_10px_#B2F838]"></div>
                    </div>
                </div>

                <!-- Stat Card 2 -->
                <div class="glass-panel p-5 rounded-lg">
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-[10px] text-mute uppercase tracking-widest">Lifecycle Units</span>
                    </div>
                    <div class="flex flex-col gap-3">
                        <div class="flex justify-between text-xs">
                            <span class="text-white">GHUNGHAT</span>
                            <span class="text-matcha">EXPANDING</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span class="text-white">KRISHNA_FOOD</span>
                            <span class="text-mute">STABLE</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span class="text-white">MOOLCHAND</span>
                            <span class="text-mute">SCALING</span>
                        </div>
                    </div>
                </div>

                <!-- Footer Quote -->
                <div class="mt-auto text-[10px] text-mute leading-relaxed border-t border-border pt-4">
                    "Control essentials. Diversify gradually. Build evergreen wealth."
                </div>

            </aside>

        </main>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        /**
         * AUDIO ENGINE
         * Uses Web Audio API to synthesize sounds without external files.
         * Handles Boot Chime, Ambient Drone, and Key Clicks.
         */
        class AudioEngine {
            constructor() {
                this.ctx = null;
                this.ambientOsc = null;
                this.ambientGain = null;
                this.isAmbientPlaying = false;
            }

            init() {
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.ctx = new AudioContext();
                    this.playBootSound();
                } catch (e) {
                    console.warn("Audio init failed", e);
                }
            }

            toggleAmbient() {
                if (!this.ctx) return;
                
                if (this.isAmbientPlaying) {
                    // Fade out
                    const curr = this.ambientGain.gain.value;
                    this.ambientGain.gain.cancelScheduledValues(this.ctx.currentTime);
                    this.ambientGain.gain.setValueAtTime(curr, this.ctx.currentTime);
                    this.ambientGain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 2);
                    setTimeout(() => {
                        this.ambientOsc.stop();
                        this.isAmbientPlaying = false;
                    }, 2000);
                    return false;
                } else {
                    // Start Drone (Low Sine Wave + Noise simulation via modulation)
                    this.ambientOsc = this.ctx.createOscillator();
                    this.ambientGain = this.ctx.createGain();
                    
                    // Filter to make it dark
                    const filter = this.ctx.createBiquadFilter();
                    filter.type = 'lowpass';
                    filter.frequency.value = 120;

                    this.ambientOsc.type = 'sine';
                    this.ambientOsc.frequency.value = 55; // A1 (Low drone)
                    
                    this.ambientOsc.connect(filter);
                    filter.connect(this.ambientGain);
                    this.ambientGain.connect(this.ctx.destination);

                    this.ambientGain.gain.setValueAtTime(0.001, this.ctx.currentTime);
                    this.ambientGain.gain.exponentialRampToValueAtTime(0.08, this.ctx.currentTime + 4); // Slow fade in
                    
                    this.ambientOsc.start();
                    this.isAmbientPlaying = true;
                    return true;
                }
            }

            playBootSound() {
                if (!this.ctx) return;
                const t = this.ctx.currentTime;
                
                // Oscillator 1 (Root)
                const osc1 = this.ctx.createOscillator();
                const gain1 = this.ctx.createGain();
                osc1.type = "sine";
                osc1.frequency.setValueAtTime(220, t); // A3
                gain1.gain.setValueAtTime(0, t);
                gain1.gain.linearRampToValueAtTime(0.1, t + 0.5);
                gain1.gain.exponentialRampToValueAtTime(0.001, t + 4);
                
                // Oscillator 2 (Fifth)
                const osc2 = this.ctx.createOscillator();
                const gain2 = this.ctx.createGain();
                osc2.type = "triangle";
                osc2.frequency.setValueAtTime(329.63, t); // E4
                gain2.gain.setValueAtTime(0, t);
                gain2.gain.linearRampToValueAtTime(0.05, t + 0.6);
                gain2.gain.exponentialRampToValueAtTime(0.001, t + 3);

                osc1.connect(gain1);
                osc2.connect(gain2);
                gain1.connect(this.ctx.destination);
                gain2.connect(this.ctx.destination);

                osc1.start(t);
                osc2.start(t);
                osc1.stop(t + 4);
                osc2.stop(t + 4);
            }

            playKeyClick() {
                if (!this.ctx) return;
                // Create a short burst of noise/high freq
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                osc.frequency.setValueAtTime(800 + Math.random() * 200, this.ctx.currentTime);
                osc.type = 'square'; // Clicky
                
                gain.gain.setValueAtTime(0.02, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.05);
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                
                osc.start();
                osc.stop(this.ctx.currentTime + 0.05);
            }
        }

        /**
         * STORAGE WRAPPER
         * Fallback mechanism for resilience.
         */
        const Storage = {
            data: [],
            key: 'empire_logs_v1',
            init() {
                try {
                    const stored = localStorage.getItem(this.key);
                    if (stored) {
                        this.data = JSON.parse(stored);
                    } else {
                        this.seed();
                    }
                } catch (e) {
                    console.log("Storage unavailable, using memory.");
                    this.seed();
                }
            },
            seed() {
                // Default Founder Data
                this.data = [
                    {
                        id: 3,
                        timestamp: new Date().toISOString(),
                        content: "Long term thesis for [tag:JAIPUR]: The city is expanding south. [secure]Acquiring land bank near Ring Road.[/secure] Ideally positioned for Krishna Realty logistics hub.",
                        type: 'strategy'
                    },
                    {
                        id: 2,
                        timestamp: new Date(Date.now() - 86400000).toISOString(),
                        content: "Reviewing [tag:MOOLCHAND_FINANCE] disbursement rates. Integration with Ghunghat for wedding loans is showing 40% uptick. The flywheel effect is starting.",
                        type: 'log'
                    },
                    {
                        id: 1,
                        timestamp: new Date(Date.now() - 172800000).toISOString(),
                        content: "Master Plan Initiation. Vertical integration is the only path to sovereignty. [tag:GHUNGHAT] feeds [tag:KRISHNA_FOOD]. Ecosystem locking in.",
                        type: 'milestone'
                    }
                ];
                this.save();
            },
            add(text) {
                const entry = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    content: text,
                    type: 'log'
                };
                this.data.unshift(entry);
                this.save();
                return entry;
            },
            save() {
                try {
                    localStorage.setItem(this.key, JSON.stringify(this.data));
                } catch(e) {}
            },
            getAll() {
                return this.data;
            }
        };

        /**
         * RENDERER & LOGIC
         */
        const audio = new AudioEngine();
        const appInterface = document.getElementById('app-interface');
        const initOverlay = document.getElementById('init-overlay');
        const feed = document.getElementById('log-feed');
        const input = document.getElementById('log-input');

        // Helper: Time Format
        function formatTime(iso) {
            const d = new Date(iso);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' // ' + 
                   d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        // Helper: Parser
        function parseContent(text) {
            // Escape HTML first
            let clean = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            
            // Tag Parsing: [tag:Name]
            clean = clean.replace(/\[tag:(.*?)\]/g, (match, p1) => {
                return `<span class="text-[10px] font-bold text-black bg-matcha px-1.5 py-0.5 rounded mx-1 uppercase tracking-wider shadow-[0_0_8px_rgba(178,248,56,0.5)]">${p1}</span>`;
            });

            // Secure Parsing: [secure]...[/secure]
            clean = clean.replace(/\[secure\](.*?)\[\/secure\]/g, (match, p1) => {
                // Encode secret in data attribute
                return `<span class="secure-redact" onclick="toggleSecure(this)" data-secret="${p1}">****</span>`;
            });

            // Image Parsing: [img:url]
            clean = clean.replace(/\[img:(.*?)\]/g, (match, p1) => {
                return `<div class="mt-4 mb-2 overflow-hidden rounded border border-border group relative aspect-video">
                            <img src="${p1}" class="w-full h-full object-cover grayscale opacity-80 group-hover:grayscale-0 group-hover:opacity-100 transition-all duration-700" onerror="this.style.display='none'">
                            <div class="absolute bottom-2 left-2 text-[10px] bg-black/50 backdrop-blur px-2 py-1 text-white uppercase">Visual Reference</div>
                        </div>`;
            });

            return clean;
        }

        // Render Single Entry
        function createEntryNode(entry) {
            const div = document.createElement('div');
            div.className = "flex gap-4 md:gap-8 group animate-scale-in origin-left";
            div.innerHTML = `
                <div class="flex flex-col items-center pt-1">
                    <div class="w-2 h-2 rounded-full bg-border group-hover:bg-matcha transition-colors duration-500"></div>
                    <div class="w-px h-full bg-border/30 mt-2 group-last:hidden"></div>
                </div>
                <div class="pb-8 flex-1">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="text-[10px] font-mono text-matcha/70">${formatTime(entry.timestamp)}</span>
                        ${entry.id === 1 ? '<span class="text-[9px] border border-alert text-alert px-1 rounded">ORIGIN</span>' : ''}
                    </div>
                    <div class="text-sm md:text-base leading-relaxed text-gray-200 font-light">
                        ${parseContent(entry.content)}
                    </div>
                </div>
            `;
            return div;
        }

        function renderFeed() {
            feed.innerHTML = '<div class="absolute left-0 top-0 bottom-0 w-px bg-border -ml-px hidden md:block" style="left: -2rem;"></div>';
            Storage.getAll().forEach(entry => {
                feed.appendChild(createEntryNode(entry));
            });
        }

        // Global function for secure toggle
        window.toggleSecure = function(el) {
            if (el.classList.contains('revealed')) return;
            const secret = el.dataset.secret;
            let iterations = 0;
            const interval = setInterval(() => {
                el.innerText = secret.split('').map((letter, index) => {
                    if(index < iterations) {
                        return secret[index];
                    }
                    return "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()"[Math.floor(Math.random() * 26)];
                }).join('');
                
                if(iterations >= secret.length){ 
                    clearInterval(interval);
                    el.classList.add('revealed');
                }
                iterations += 1/3;
            }, 30);
            
            // Tiny sound effect
            audio.playKeyClick();
        };

        // --- Event Listeners ---

        // Initialize Button
        document.getElementById('init-btn').addEventListener('click', () => {
            audio.init();
            initOverlay.style.opacity = '0';
            setTimeout(() => {
                initOverlay.remove();
                appInterface.classList.remove('opacity-0', 'pointer-events-none');
                appInterface.classList.add('opacity-100');
            }, 1000);
        });

        // Submit Log
        function submitEntry() {
            const txt = input.value.trim();
            if (!txt) return;
            Storage.add(txt);
            renderFeed();
            input.value = '';
            audio.playKeyClick(); // Feedback
        }

        document.getElementById('submit-log').addEventListener('click', submitEntry);
        
        // Typing Sounds & Shortcuts
        input.addEventListener('keydown', (e) => {
            audio.playKeyClick();
            if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                submitEntry();
            }
        });

        // Ambient Toggle
        const ambientToggle = document.getElementById('ambient-toggle');
        const ambientIndicator = document.getElementById('ambient-indicator');
        
        ambientToggle.addEventListener('click', () => {
            const isActive = audio.toggleAmbient();
            if (isActive) {
                ambientIndicator.classList.remove('bg-mute');
                ambientIndicator.classList.add('bg-matcha', 'shadow-[0_0_8px_#B2F838]');
            } else {
                ambientIndicator.classList.add('bg-mute');
                ambientIndicator.classList.remove('bg-matcha', 'shadow-[0_0_8px_#B2F838]');
            }
        });

        // Time Update
        setInterval(() => {
            const d = new Date();
            document.getElementById('system-time').innerText = d.toISOString().split('T')[1].split('.')[0] + ' UTC';
        }, 1000);

        // Init Data
        Storage.init();
        renderFeed();

    </script>
</body>
</html>
