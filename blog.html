<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROVEXA // EMPIRE OS</title>
    
    <!-- Fonts: JetBrains Mono Only -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            black: '#050505',
                            matcha: '#B2F838',      // Primary (System)
                            vapor: '#F2F4F8',       // Text
                            dim: '#1a1a1a',         // Borders
                            alert: '#FF3333',       // Errors
                            ghunghat: '#FF00FF',    // Pink
                            realty: '#00FFFF',      // Cyan
                            food: '#FF9900',        // Orange
                            finance: '#FFFF00',     // Yellow
                        }
                    },
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    boxShadow: {
                        'glow': '0 0 10px rgba(178, 248, 56, 0.3)',
                        'glow-strong': '0 0 20px rgba(178, 248, 56, 0.5)',
                        'alert-glow': '0 0 30px rgba(255, 51, 51, 0.6)',
                    },
                    animation: {
                        'scan': 'scan 4s linear infinite',
                        'flash-red': 'flashRed 0.5s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        scan: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' }
                        },
                        flashRed: {
                            '0%, 100%': { backgroundColor: '#050505' },
                            '50%': { backgroundColor: '#330000' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #F2F4F8;
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            cursor: default; /* Default cursor */
        }

        /* CRT EFFECTS */
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 3px;
            z-index: 50;
            pointer-events: none;
        }
        .crt::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.6) 100%);
            z-index: 50;
            pointer-events: none;
        }

        /* HOLOGRAPHIC IMAGE STYLE */
        .holo-img-container {
            position: relative;
            overflow: hidden;
            border: 1px solid #1a1a1a;
            transition: all 0.3s ease;
            filter: sepia(1) hue-rotate(50deg) saturate(3) contrast(1.2);
            opacity: 0.8;
            mix-blend-mode: screen;
        }
        .holo-img-container:hover {
            filter: none;
            opacity: 1;
            mix-blend-mode: normal;
            border-color: #B2F838;
        }
        .holo-scanline {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(178, 248, 56, 0.2), transparent);
            animation: scan 2s linear infinite;
            pointer-events: none;
        }

        /* SCROLLING TICKER */
        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
        }
        .ticker {
            display: inline-block;
            animation: ticker 25s linear infinite;
        }
        @keyframes ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* INPUT & SCROLLBAR */
        input { background: transparent; outline: none; caret-color: #B2F838; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #1a1a1a; border: 1px solid #B2F838; }
        ::-webkit-scrollbar-thumb:hover { background: #B2F838; }

        .log-entry {
            border-left: 1px solid #1a1a1a;
            padding-left: 1.5rem;
            transition: border-color 0.3s ease;
        }
        .log-entry:hover { border-left: 3px solid #B2F838; }

        /* Start Overlay Hover */
        #start-overlay:hover h1 {
            text-shadow: 0 0 20px rgba(178, 248, 56, 0.8);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }
    </style>
</head>
<body id="main-body" class="h-screen w-screen crt flex flex-col relative selection:bg-cyber-matcha selection:text-black">

    <!-- CLICK TO START -->
    <div id="start-overlay" class="absolute inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center cursor-pointer transition-opacity duration-700 select-none">
        <div class="relative">
            <h1 class="text-4xl md:text-7xl font-black tracking-[0.2em] text-cyber-matcha mb-6 animate-pulse-slow" style="text-shadow: 0 0 15px rgba(178,248,56,0.3)">ROVEXA</h1>
            <div class="absolute -bottom-2 w-full h-1 bg-cyber-matcha/20"></div>
            <div class="absolute -bottom-2 w-1/3 h-1 bg-cyber-matcha animate-pulse"></div>
        </div>
        <p class="text-xs md:text-sm tracking-[0.3em] text-gray-500 mt-4 group-hover:text-cyber-matcha transition-colors">[ TAP TERMINAL TO INITIALIZE ]</p>
    </div>

    <!-- BOOT SCREEN -->
    <div id="boot-screen" class="absolute inset-0 z-[90] bg-black p-8 md:p-16 text-sm md:text-base hidden flex flex-col justify-end pb-32">
        <div id="boot-text" class="space-y-2 font-mono"></div>
        <div id="progress-bar" class="mt-4 text-cyber-matcha font-bold hidden"></div>
    </div>

    <!-- HEADER & TICKER -->
    <header class="flex flex-col border-b border-cyber-dim bg-black/90 z-40 backdrop-blur-sm">
        <div class="flex justify-between items-center p-3 md:px-6">
            <div class="flex items-center gap-3">
                <div class="w-2 h-2 bg-cyber-matcha rounded-full shadow-glow animate-pulse"></div>
                <h1 class="text-lg font-bold text-cyber-matcha tracking-widest">ROVEXA <span class="text-xs text-gray-500 font-normal ml-2">EMPIRE_OS v5.1</span></h1>
            </div>
            <div class="flex items-center gap-6 text-xs font-bold tracking-wider">
                 <button id="drone-toggle" class="text-gray-600 hover:text-cyber-matcha transition-colors">[ AUDIO_DRONE ]</button>
                <span class="text-gray-500 hidden md:inline">LOC: <span class="text-cyber-vapor">JAIPUR_HQ</span></span>
            </div>
        </div>
        <!-- Live Ticker -->
        <div class="bg-cyber-dim/20 py-1.5 border-t border-cyber-dim/50 text-[10px] text-gray-400 font-mono tracking-widest overflow-hidden">
            <div class="ticker-wrap">
                <div class="ticker" id="kpi-ticker">
                     /// GHUNGHAT_EVENTS: +18% Q3 /// KRISHNA_REALTY: LAND_BANK_EXPANDING /// MOOLCHAND_FIN: LICENSING_APPROVED /// KRISHNA_MOTORS: INVENTORY_OPTIMIZED /// ECOSYSTEM_STATUS: VERTICAL_INTEGRATION_ACTIVE /// 
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN FEED -->
    <main id="feed-container" class="flex-1 overflow-y-auto p-4 md:p-12 space-y-10 pb-32 scroll-smooth">
        <!-- Logs injected here -->
    </main>

    <!-- TERMINAL FOOTER -->
    <footer class="border-t border-cyber-dim bg-black/95 p-4 z-40 absolute bottom-0 w-full shadow-glow backdrop-blur">
        <div class="max-w-7xl mx-auto flex items-center text-lg">
            <span id="prompt-user" class="text-cyber-matcha mr-3 select-none font-bold">guest@rovexa:~#</span>
            <input 
                type="text" 
                id="cmd-input" 
                class="flex-1 border-none text-cyber-vapor placeholder-gray-800 bg-transparent focus:ring-0"
                placeholder="awaiting_command..."
                autocomplete="off"
                spellcheck="false"
            >
        </div>
    </footer>

    <!-- LOGIN MODAL -->
    <div id="login-modal" class="hidden fixed inset-0 z-[80] bg-black/90 flex items-center justify-center backdrop-blur-md">
        <div class="w-full max-w-sm border border-cyber-matcha p-8 bg-black shadow-glow-strong relative" id="login-box">
            <div class="absolute -top-3 left-4 bg-cyber-matcha text-black text-xs px-2 py-1 font-bold">SECURE GATEWAY</div>
            <h2 class="text-xl mb-6 text-center tracking-widest text-cyber-matcha mt-2">AUTHENTICATE</h2>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <input type="email" id="email" class="w-full border-b border-gray-800 py-2 focus:border-cyber-matcha transition-colors text-center text-cyber-vapor tracking-widest placeholder-gray-700 bg-transparent" placeholder="IDENTIFIER" required>
                </div>
                <div>
                    <input type="password" id="password" class="w-full border-b border-gray-800 py-2 focus:border-cyber-matcha transition-colors text-center text-cyber-vapor tracking-widest placeholder-gray-700 bg-transparent" placeholder="KEY" required>
                </div>
                <button type="submit" class="w-full border border-cyber-matcha py-3 text-cyber-matcha hover:bg-cyber-matcha hover:text-black transition-all duration-200 font-bold tracking-widest mt-4">
                    [ ACCESS ]
                </button>
            </form>
            <div id="login-msg" class="text-center text-cyber-alert text-xs mt-2 h-4 font-mono"></div>
            <button id="close-modal" class="absolute top-2 right-2 text-gray-600 hover:text-white text-xl">Ã—</button>
        </div>
    </div>

    <!-- SECURITY ALERT OVERLAY -->
    <div id="intruder-overlay" class="hidden fixed inset-0 z-[200] bg-red-900/50 flex flex-col items-center justify-center animate-flash-red pointer-events-none">
        <h1 class="text-4xl md:text-8xl font-black text-white tracking-widest mb-4">INTRUDER ALERT</h1>
        <p class="text-xl md:text-2xl text-white font-mono tracking-[0.5em]">SYSTEM LOCKDOWN INITIATED</p>
        <p id="lockdown-timer" class="text-6xl text-white font-mono mt-8 font-bold">10</p>
    </div>

    <script>
        // ------------------------------------------------------------------
        // 1. AUDIO SYSTEM (ROBUST & FAIL-SAFE)
        // ------------------------------------------------------------------
        class AudioSystem {
            constructor() {
                this.ctx = null;
                this.droneOsc = null;
                this.droneGain = null;
                this.isDroneOn = false;
            }

            // Initialize with Resume capability for Chrome/Edge
            async init() {
                if (!this.ctx) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) {
                        this.ctx = new AudioContext();
                    }
                }
                // Try to resume if suspended (common browser policy)
                if (this.ctx && this.ctx.state === 'suspended') {
                    try {
                        await this.ctx.resume();
                    } catch(e) { console.warn("Audio resume failed", e); }
                }
            }

            toggleDrone() {
                this.init(); // Ensure init
                if (!this.ctx) return false;

                if (this.isDroneOn) {
                    // Fade out
                    try {
                        const now = this.ctx.currentTime;
                        this.droneGain.gain.exponentialRampToValueAtTime(0.001, now + 1);
                        setTimeout(() => {
                            if(this.droneOsc) { this.droneOsc.stop(); this.droneOsc = null; }
                        }, 1000);
                        this.isDroneOn = false;
                    } catch(e) {}
                    return false;
                } else {
                    try {
                        // Create Drone
                        this.droneOsc = this.ctx.createOscillator();
                        this.droneGain = this.ctx.createGain();
                        const filter = this.ctx.createBiquadFilter();
                        
                        this.droneOsc.type = 'sawtooth';
                        this.droneOsc.frequency.value = 50; 
                        
                        filter.type = 'lowpass';
                        filter.frequency.value = 120; 

                        this.droneOsc.connect(filter);
                        filter.connect(this.droneGain);
                        this.droneGain.connect(this.ctx.destination);
                        
                        this.droneGain.gain.setValueAtTime(0.001, this.ctx.currentTime);
                        this.droneGain.gain.exponentialRampToValueAtTime(0.08, this.ctx.currentTime + 2); 
                        
                        this.droneOsc.start();
                        this.isDroneOn = true;
                    } catch(e) { console.warn("Drone failed", e); return false; }
                    return true;
                }
            }

            playTone(freq, type, duration, vol = 0.05) {
                if (!this.ctx) return;
                try {
                    const osc = this.ctx.createOscillator();
                    const g = this.ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                    g.gain.setValueAtTime(vol, this.ctx.currentTime);
                    g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
                    osc.connect(g);
                    g.connect(this.ctx.destination);
                    osc.start();
                    osc.stop(this.ctx.currentTime + duration);
                } catch(e) {}
            }

            playKeystroke() { this.playTone(800 + Math.random()*200, 'square', 0.05, 0.02); }
            playEnter() { this.playTone(300, 'sine', 0.1, 0.05); }
            playError() { this.playTone(150, 'sawtooth', 0.3, 0.1); }
            playBoot() {
                 if (!this.ctx) return;
                 try {
                    const now = this.ctx.currentTime;
                    const osc = this.ctx.createOscillator();
                    const g = this.ctx.createGain();
                    osc.connect(g); g.connect(this.ctx.destination);
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.linearRampToValueAtTime(600, now + 0.8);
                    g.gain.setValueAtTime(0.1, now);
                    g.gain.linearRampToValueAtTime(0, now + 1.5);
                    osc.start(); osc.stop(now + 1.5);
                 } catch(e){}
            }
            
            playSiren() {
                if (!this.ctx) return;
                const playCycle = () => {
                     const osc = this.ctx.createOscillator();
                     const g = this.ctx.createGain();
                     osc.type = 'sawtooth';
                     g.gain.value = 0.1;
                     osc.connect(g); g.connect(this.ctx.destination);
                     const now = this.ctx.currentTime;
                     osc.frequency.setValueAtTime(600, now);
                     osc.frequency.linearRampToValueAtTime(1200, now + 0.5);
                     osc.frequency.linearRampToValueAtTime(600, now + 1.0);
                     osc.start(); osc.stop(now + 1.0);
                };
                playCycle();
                setTimeout(playCycle, 1000);
                setTimeout(playCycle, 2000);
            }
        }
        const sfx = new AudioSystem();

        // ------------------------------------------------------------------
        // 2. DATA & LOGIC
        // ------------------------------------------------------------------
        class SystemCore {
            constructor() {
                this.key = 'rovexa_empire_v1';
                this.data = this.load();
                this.tagColors = {
                    'GHUNGHAT': 'text-cyber-ghunghat border-cyber-ghunghat',
                    'REALTY': 'text-cyber-realty border-cyber-realty',
                    'FOOD': 'text-cyber-food border-cyber-food',
                    'FINANCE': 'text-cyber-finance border-cyber-finance',
                    'DEFAULT': 'text-cyber-matcha border-cyber-matcha'
                };
            }
            load() {
                try {
                    const d = localStorage.getItem(this.key);
                    return d ? JSON.parse(d) : this.defaults();
                } catch { return this.defaults(); }
            }
            defaults() {
                return [
                     { 
                        id: '2', 
                        title: 'MASTER_PLAN_EXPANSION', 
                        content: 'Jaipur Nodal HQ blueprint finalized. [img:https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&w=800&q=80] The vertical integration strategy requires land acquisition near Tonk Road.', 
                        time: new Date(Date.now()-3600000).toISOString() 
                    },
                    { 
                        id: '1', 
                        title: 'CONFIDENTIAL_ASSET', 
                        content: 'Negotiations with Minister Singh regarding Moolchand Finance licensing. [secure]', 
                        time: new Date().toISOString() 
                    }
                ];
            }
            save() { try { localStorage.setItem(this.key, JSON.stringify(this.data)); } catch(e){} }
            add(text) {
                let title = "SYSTEM_LOG";
                let content = text;
                if(text.includes('::')) {
                    const parts = text.split('::');
                    title = parts[0].trim();
                    content = parts.slice(1).join('::').trim();
                }
                this.data.unshift({ id: Date.now().toString(), title, content, time: new Date().toISOString() });
                this.save();
            }
            del(id) { this.data = this.data.filter(l => l.id !== id); this.save(); }
        }
        const sys = new SystemCore();
        
        let isAdmin = false;
        let commandHistory = [];
        let historyIndex = -1;
        let failedLoginAttempts = 0;

        // ------------------------------------------------------------------
        // 3. UI RENDERING
        // ------------------------------------------------------------------
        const els = {
            feed: document.getElementById('feed-container'),
            input: document.getElementById('cmd-input'),
            boot: document.getElementById('boot-screen'),
            bootText: document.getElementById('boot-text'),
            start: document.getElementById('start-overlay'),
            modal: document.getElementById('login-modal'),
            prompt: document.getElementById('prompt-user'),
            intruder: document.getElementById('intruder-overlay'),
            timer: document.getElementById('lockdown-timer'),
            droneBtn: document.getElementById('drone-toggle'),
            progressBar: document.getElementById('progress-bar')
        };

        function processContent(content) {
            let html = content;
            const imgRegex = /\[img:(.*?)\]/g;
            html = html.replace(imgRegex, (match, url) => `
                <div class="mt-4 mb-2 max-w-md">
                    <div class="holo-img-container rounded bg-black">
                        <div class="holo-scanline"></div>
                        <img src="${url}" class="w-full h-auto object-cover" onerror="this.src='https://via.placeholder.com/400x200/003300/00ff00?text=IMG_ERR'">
                    </div>
                </div>`);
            
            const tagRegex = /\[tag:(.*?)\]/g;
            html = html.replace(tagRegex, (match, name) => {
                const upperName = name.toUpperCase();
                let colorClass = sys.tagColors[upperName];
                if(!colorClass) {
                    if(upperName.includes('GHUNGHAT')) colorClass = sys.tagColors['GHUNGHAT'];
                    else if(upperName.includes('KRISHNA')) colorClass = sys.tagColors['FOOD'];
                    else colorClass = sys.tagColors['DEFAULT'];
                }
                return `<span class="inline-block text-[10px] px-2 py-0.5 border ${colorClass} rounded mr-2 tracking-wider font-bold mb-1 opacity-80">${upperName}</span>`;
            });

            if (html.includes('[secure]')) {
                const cleanContent = html.replace('[secure]', '');
                const scrambled = cleanContent.replace(/[a-zA-Z]/g, () => 'Â¥Â§Â±ÂµÂ¶@#%&'[Math.floor(Math.random()*10)]);
                const uid = Math.random().toString(36).substr(2, 9);
                return `
                    <div id="enc-${uid}" class="text-cyber-alert mt-2 font-mono break-all cursor-pointer hover:text-white transition-colors" onclick="decryptLog('${uid}', '${escapeHtml(cleanContent)}')">
                        <span class="mr-2">ðŸ”’ ENCRYPTED:</span>
                        <span class="blur-[1px]">${scrambled}</span>
                        <span class="ml-2 text-xs border border-cyber-alert px-1">[DECRYPT]</span>
                    </div>`;
            }
            return html;
        }

        window.decryptLog = (id, content) => {
            sfx.playEnter();
            const el = document.getElementById(`enc-${id}`);
            el.innerHTML = `<span class="text-cyber-matcha">${content}</span>`;
            el.classList.remove('text-cyber-alert');
        };

        function renderFeed(filter = null) {
            els.feed.innerHTML = '';
            const displayData = filter 
                ? sys.data.filter(l => l.title.toLowerCase().includes(filter) || l.content.toLowerCase().includes(filter))
                : sys.data;
            if(displayData.length === 0) { els.feed.innerHTML = '<div class="text-gray-600 italic">>> NO RECORDS FOUND</div>'; return; }

            displayData.forEach((log, i) => {
                const el = document.createElement('div');
                el.className = 'log-entry opacity-0';
                el.style.animation = `fadeSlide 0.4s ease forwards ${i * 0.1}s`;
                const time = new Date(log.time).toLocaleString('en-GB', { hour12: false }).replace(',', '');
                const delBtn = isAdmin ? `<button onclick="deleteLog('${log.id}')" class="ml-4 text-cyber-alert hover:underline px-1 text-xs tracking-wider">[PURGE]</button>` : '';
                el.innerHTML = `
                    <div class="text-xs text-gray-500 mb-2 flex items-center tracking-wider font-bold">
                        <span class="text-gray-600 mr-2">ID::${log.id.substring(0,4)}</span>
                        <span>[${time}]</span>
                        ${delBtn}
                    </div>
                    <h3 class="text-xl md:text-2xl font-bold text-cyber-matcha mb-3 tracking-wide" style="text-shadow: 0 0 10px rgba(178, 248, 56, 0.2);">
                        > ${log.title}
                    </h3>
                    <div class="text-cyber-vapor text-sm md:text-base leading-relaxed max-w-4xl whitespace-pre-wrap opacity-90 font-mono">${processContent(log.content)}</div>
                `;
                els.feed.appendChild(el);
            });
        }

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `@keyframes fadeSlide { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }`;
        document.head.appendChild(styleSheet);
        window.deleteLog = (id) => { if(confirm('CONFIRM PURGE?')) { sys.del(id); renderFeed(); } };
        function escapeHtml(text) { return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;"); }

        // ------------------------------------------------------------------
        // 4. INTERACTION
        // ------------------------------------------------------------------
        els.droneBtn.addEventListener('click', () => {
            const isActive = sfx.toggleDrone();
            els.droneBtn.classList.toggle('text-cyber-matcha', isActive);
            els.droneBtn.classList.toggle('text-gray-600', !isActive);
        });

        els.input.addEventListener('keydown', (e) => {
            if(e.key === 'ArrowUp') {
                e.preventDefault();
                if(historyIndex < commandHistory.length - 1) { historyIndex++; els.input.value = commandHistory[commandHistory.length - 1 - historyIndex]; }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if(historyIndex > 0) { historyIndex--; els.input.value = commandHistory[commandHistory.length - 1 - historyIndex]; } else { historyIndex = -1; els.input.value = ''; }
            }

            if(e.key !== 'Enter') { sfx.playKeystroke(); return; }

            const val = els.input.value.trim();
            if(!val) return;
            sfx.playEnter();
            commandHistory.push(val); historyIndex = -1; els.input.value = '';

            if(val === 'login') { showLogin(); return; }
            if(val === 'clear') { els.feed.innerHTML = ''; return; }
            if(val === 'refresh') { renderFeed(); return; }
            if(val === 'weather') {
                els.feed.innerHTML = `<div class="log-entry animate-pulse text-cyber-matcha">> FETCHING DATA...<br>> JAIPUR: 32Â°C // AQI: 112<br>> SKY: CLEAR</div>` + els.feed.innerHTML;
                return;
            }
            if(val.startsWith('search ')) { renderFeed(val.replace('search ', '').toLowerCase()); return; }

            if(isAdmin) {
                if(val === 'logout') {
                    isAdmin = false;
                    els.prompt.textContent = 'guest@rovexa:~#';
                    els.prompt.className = "text-cyber-matcha mr-3 select-none font-bold";
                    renderFeed();
                } else { sys.add(val); renderFeed(); els.feed.scrollTop = 0; }
            } else {
                if(val !== 'help') alert('ACCESS DENIED. TRY "login".');
                else alert('COMMANDS:\n> login\n> weather\n> search [kw]\n> clear');
            }
        });

        function showLogin() { els.modal.classList.remove('hidden'); document.getElementById('email').focus(); }
        document.getElementById('close-modal').onclick = () => els.modal.classList.add('hidden');
        document.getElementById('login-form').onsubmit = (e) => {
            e.preventDefault();
            const pass = document.getElementById('password').value;
            if (pass.toLowerCase() === 'wrong') {
                failedLoginAttempts++;
                sfx.playError();
                document.getElementById('login-msg').textContent = `ERR: INVALID CREDENTIALS. ATTEMPT ${failedLoginAttempts}/3`;
                if(failedLoginAttempts >= 3) triggerIntruderAlert();
                return;
            }
            sfx.playEnter();
            failedLoginAttempts = 0;
            isAdmin = true;
            els.prompt.textContent = 'root@rovexa:~#';
            els.prompt.className = "text-cyber-alert mr-3 select-none font-bold";
            els.modal.classList.add('hidden');
            renderFeed();
        };

        function triggerIntruderAlert() {
            els.modal.classList.add('hidden');
            els.intruder.classList.remove('hidden');
            sfx.playSiren();
            let time = 10;
            const timerInt = setInterval(() => {
                time--; els.timer.textContent = time;
                if(time <= 0) { clearInterval(timerInt); els.intruder.classList.add('hidden'); failedLoginAttempts = 0; location.reload(); }
            }, 1000);
        }

        // ------------------------------------------------------------------
        // 5. BOOT SEQUENCE (IMPROVED)
        // ------------------------------------------------------------------
        // Robust click handler that works even if audio fails
        els.start.addEventListener('click', async () => {
            // 1. Try Audio Init (Fail-Safe)
            try {
                await sfx.init(); 
                sfx.playBoot();
            } catch(e) {
                console.log("Audio init blocked, proceeding visually.");
            }

            // 2. Visual Transition
            els.start.style.opacity = '0';
            setTimeout(() => els.start.remove(), 700);
            els.boot.classList.remove('hidden');
            els.boot.classList.add('flex'); // Ensure flex display

            // 3. Typewriter Sequence
            const lines = [
                "INITIALIZING ROVEXA EMPIRE OS...",
                "CHECKING ASSETS... 128TB [OK]",
                "CONNECTING TO JAIPUR_NODAL... [SECURE]",
                "SYNCING VERTICALS: GHUNGHAT, KRISHNA, MOOLCHAND...",
                "SYSTEM_STATUS: EXPANDING...",
                "BIOMETRICS VERIFIED.",
                "WELCOME BACK, FOUNDER."
            ];
            
            let i = 0;
            function typeLine() {
                if (i >= lines.length) {
                    setTimeout(() => {
                        els.boot.classList.add('hidden');
                        renderFeed();
                        els.input.focus(); // AUTO-FOCUS INPUT
                    }, 1000);
                    return;
                }

                const line = document.createElement('div');
                line.className = "text-cyber-matcha opacity-0 animate-fade-in";
                // Add slight randomness to typing speed
                line.style.animation = "fadeSlide 0.1s forwards";
                line.textContent = `> ${lines[i]}`;
                els.bootText.appendChild(line);
                
                // Progress Bar Update
                els.progressBar.classList.remove('hidden');
                let bar = "[";
                for(let b=0; b<10; b++) { bar += (b < (i/lines.length)*10) ? "=" : "&nbsp;"; }
                bar += "] " + Math.floor(((i+1)/lines.length)*100) + "%";
                els.progressBar.innerHTML = bar;

                sfx.playKeystroke();
                i++;
                setTimeout(typeLine, 150 + Math.random() * 100);
            }
            typeLine();
        });

    </script>
</body>
</html>